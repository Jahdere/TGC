src/game/Unit.cpp View
@@ -2832,6 +2832,9 @@ SpellMissInfo Unit::MagicSpellHitResult(Unit* pVictim, SpellEntry const* spell)
    if (!pVictim->isAlive())
      return SPELL_MISS_NONE;
  
+   if(!this->IsHostileTo(pVictim))
+     return SPELL_MISS_NONE;
+ 
    SpellSchoolMask schoolMask = GetSpellSchoolMask(spell);
    // PvP - PvE spell misschances per leveldif > 2
    int32 lchance = pVictim->GetTypeId() == TYPEID_PLAYER ? 7 : 11;